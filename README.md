# MYSQL

1. 월별 주문 회원 수 , 주문 수 , 주문 금액 , 할인 금액 , 배송비

  SELECT 
    DATE_FORMAT(주문날짜, '%Y-%m') AS 월별,
    COUNT(DISTINCT 유저ID) AS 주문_회원_수,
    COUNT(주문번호) AS 주문_수,
    SUM(최종가격) AS 총_주문_금액,
    SUM(할인가격) AS 총_할인_금액,
    SUM(배송비) AS 총_배송비
  FROM 
      Orders
  GROUP BY 
      DATE_FORMAT(주문날짜, '%Y-%m')
  ORDER BY 
      월별;
결과:
# 월별, 주문_회원_수, 주문_수, 총_주문_금액, 총_할인_금액, 총_배송비
'2024-01', '82', '160', '78478149.0000', '8364797.0000', '2485186.0000'
'2024-02', '76', '122', '55344505.0000', '6185684.0000', '1637449.0000'
'2024-03', '73', '135', '63078365.0000', '6931004.0000', '2082477.0000'
'2024-04', '69', '120', '61940406.0000', '5766002.0000', '2025184.0000'
'2024-05', '74', '135', '73209190.0000', '7011622.0000', '2074911.0000'
'2024-06', '70', '127', '68385113.0000', '6766869.0000', '1913775.0000'
'2024-07', '73', '125', '59544909.0000', '5832854.0000', '2084359.0000'
'2024-08', '53', '76', '35375026.0000', '4142157.0000', '1083219.0000'

comment
> 주문한 회원의 수는 1월이 82개의 ID로 가장 많고 , 4월이 69개의 ID로 가장 적다.
> 8월은 18일 기준으로 집계했기 때문에 , 전월에 비해 많고 적고 판단하기에는 적합하지 않은 것 같다.

2. 매월 1회 이상 주문한 회원의 수

SELECT 
    COUNT(*) AS 회원_수
FROM 
    (
        SELECT 
            유저ID,
            COUNT(DISTINCT DATE_FORMAT(주문날짜, '%Y-%m')) AS 주문_월수
        FROM 
            Orders
        WHERE 
            DATE_FORMAT(주문날짜, '%Y-%m') BETWEEN '2024-01' AND '2024-08'
        GROUP BY 
            유저ID
        HAVING 
            주문_월수 = 8
    ) as subquery;

결과:
# 회원_수
'4'

comment
> 1월부터 8월까지 적어도 한달에 한번 주문한 회원의 수는 100개의 ID중 4개이다.


3. 3월에 A 브랜드를 구매한 회원의 주문 건수

SELECT 
    u.이름 AS 회원명, 
    COUNT(DISTINCT o.주문번호) AS 첫_구매_건수,
    SUM(o.최종가격) AS 첫_구매_총_금액,
    SUM(o.할인가격) AS 첫_구매_총_할인,
    SUM(o.배송비) AS 첫_구매_총_배송비
FROM 
    Orders AS o
JOIN 
    Users AS u ON o.유저ID = u.이름
JOIN 
    OrderItems AS oi ON o.주문번호 = oi.주문번호
JOIN 
    ProductOptions AS po ON oi.옵션번호 = po.옵션번호
JOIN 
    Products AS p ON po.제품번호 = p.제품번호
JOIN 
    Brands AS b ON p.고유번호 = b.고유번호
WHERE 
    b.이름 = 'A' 
    AND DATE_FORMAT(o.주문날짜, '%Y-%m') = '2024-03'
    AND u.이름 IN (
        SELECT 유저ID 
        FROM Orders 
        WHERE DATE_FORMAT(주문날짜, '%Y-%m') = '2024-03'
        GROUP BY 유저ID 
        HAVING MIN(o.주문날짜)
    )
GROUP BY 
    u.이름
ORDER BY 
    첫_구매_건수 DESC;

결과:
# 회원명, 첫_구매_건수, 첫_구매_총_금액, 첫_구매_총_할인, 첫_구매_총_배송비
'ID_35', '2', '1209598.0000', '57502.0000', '42456.0000'
'ID_90', '2', '1308243.0000', '61116.0000', '25880.0000'
'ID_1', '1', '543319.0000', '94356.0000', '1586.0000'
'ID_24', '1', '323788.0000', '42461.0000', '16377.0000'
'ID_26', '1', '452972.0000', '66718.0000', '10188.0000'
'ID_29', '1', '483525.0000', '13098.0000', '7839.0000'
'ID_34', '1', '675334.0000', '2396.0000', '16419.0000'
'ID_38', '1', '463341.0000', '23846.0000', '7358.0000'
'ID_42', '1', '916657.0000', '71640.0000', '3003.0000'
'ID_54', '1', '460975.0000', '93900.0000', '21566.0000'
'ID_62', '1', '673546.0000', '65469.0000', '5141.0000'
'ID_65', '1', '468537.0000', '71914.0000', '19362.0000'
'ID_74', '1', '340035.0000', '32257.0000', '3362.0000'
'ID_8', '1', '245884.0000', '52336.0000', '17581.0000'
'ID_89', '1', '939743.0000', '92025.0000', '21859.0000'

comment:
> 3월에 A브랜드를 처음 구매한 ID는 15개이다.
> 나머지 85개의 ID는 1월 또는 2월에 A브랜드를 구매했거나 , 3월을 기준으로 아직 A브랜드를 구매하지 않은 ID이다.
> A브랜드를 구매함과 동시에 다른 브랜드도 구매한 ID는 2개이다.
