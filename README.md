# MYSQL

## 월별 주문 회원 수 , 주문 수 , 주문 금액 , 할인 금액 , 배송비

  SELECT 
    DATE_FORMAT(주문날짜, '%Y-%m') AS 월별, #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
    COUNT(DISTINCT 유저ID) AS 주문_회원_수,
    COUNT(주문번호) AS 주문_수,
    SUM(최종가격) AS 총_주문_금액,
    SUM(할인가격) AS 총_할인_금액,
    SUM(배송비) AS 총_배송비
  FROM 
      Orders
  GROUP BY 
      DATE_FORMAT(주문날짜, '%Y-%m') #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
  ORDER BY 
      월별;
결과:
월별, 주문_회원_수, 주문_수, 총_주문_금액, 총_할인_금액, 총_배송비
'2024-01', '75', '131', '64977804.0000', '6586969.0000', '1646555.0000'
'2024-02', '78', '127', '65325631.0000', '6288066.0000', '1681853.0000'
'2024-03', '76', '138', '68635934.0000', '7089758.0000', '2175216.0000'
'2024-04', '72', '126', '63999505.0000', '6560114.0000', '1947421.0000'
'2024-05', '75', '145', '68685802.0000', '7766916.0000', '2228695.0000'
'2024-06', '73', '129', '72151232.0000', '5868063.0000', '1939910.0000'
'2024-07', '69', '122', '66686341.0000', '6880300.0000', '1827532.0000'
'2024-08', '55', '82', '38033050.0000', '4219117.0000', '1218988.0000'


comment
> 주문한 회원의 수는 2월이 78개의 ID로 가장 많고 , 7월이 69개의 ID로 가장 적다.
> 8월은 18일 기준으로 집계했기 때문에 , 전월에 비해 많고 적고 판단하기에는 적합하지 않은 것 같다.

## 매월 1회 이상 주문한 회원의 수

SELECT 
    COUNT(*) AS 회원_수
FROM 
    (
        SELECT 
            유저ID,
            COUNT(DISTINCT DATE_FORMAT(주문날짜, '%Y-%m')) AS 주문_월수 #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
        FROM 
            Orders
        WHERE 
            DATE_FORMAT(주문날짜, '%Y-%m') BETWEEN '2024-01' AND '2024-08' #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
        GROUP BY 
            유저ID
        HAVING 
            주문_월수 = 8
    ) as subquery;

결과:
 회원_수
'4'

comment
> 1월부터 8월까지 적어도 한달에 한번 주문한 회원의 수는 100개의 ID중 4개이다.


## 3월에 A 브랜드를 구매한 회원의 주문 건수

SELECT 
    u.이름 AS 회원명, 
    COUNT(DISTINCT o.주문번호) AS 첫_구매_건수,
    SUM(o.최종가격) AS 첫_구매_총_금액,
    SUM(o.할인가격) AS 첫_구매_총_할인,
    SUM(o.배송비) AS 첫_구매_총_배송비
FROM 
    Orders AS o
JOIN 
    Users AS u ON o.유저ID = u.이름
JOIN 
    OrderItems AS oi ON o.주문번호 = oi.주문번호
JOIN 
    ProductOptions AS po ON oi.옵션번호 = po.옵션번호
JOIN 
    Products AS p ON po.제품번호 = p.제품번호
JOIN 
    Brands AS b ON p.고유번호 = b.고유번호
WHERE 
    b.이름 = 'A' 
    AND DATE_FORMAT(o.주문날짜, '%Y-%m') = '2024-03' #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
    AND u.이름 IN (
        SELECT 유저ID 
        FROM Orders 
        WHERE DATE_FORMAT(주문날짜, '%Y-%m') = '2024-03' #Oracle에서는 DATE_FORMAT 대신 TO_CHAR 사용
        GROUP BY 유저ID 
        HAVING MIN(o.주문날짜)
    )
GROUP BY 
    u.이름
ORDER BY 
    첫_구매_건수 DESC;

결과:
 회원명, 첫_구매_건수, 첫_구매_총_금액, 첫_구매_총_할인, 첫_구매_총_배송비
'ID_35', '2', '648521.0000', '204041.0000', '18812.0000'
'ID_60', '2', '432543.0000', '30532.0000', '6351.0000'
'ID_64', '2', '2296419.0000', '108988.0000', '3581.0000'
'ID_8', '2', '1752909.0000', '153510.0000', '36755.0000'
'ID_81', '2', '1362580.0000', '50850.0000', '38949.0000'
'ID_17', '1', '525739.0000', '12497.0000', '8010.0000'
'ID_19', '1', '215422.0000', '63526.0000', '343.0000'
'ID_23', '1', '909319.0000', '72030.0000', '23051.0000'
'ID_24', '1', '-373.0000', '96423.0000', '10844.0000'
'ID_26', '1', '994916.0000', '2510.0000', '5002.0000'
'ID_3', '1', '976480.0000', '31585.0000', '19298.0000'
'ID_37', '1', '431010.0000', '75090.0000', '21814.0000'
'ID_38', '1', '28223.0000', '99613.0000', '8671.0000'
'ID_42', '1', '831695.0000', '33326.0000', '21183.0000'
'ID_46', '1', '245758.0000', '91572.0000', '20656.0000'
'ID_49', '1', '335708.0000', '45946.0000', '12052.0000'
'ID_51', '1', '320440.0000', '46189.0000', '16799.0000'
'ID_52', '1', '3770202.0000', '152850.0000', '35979.0000'
'ID_54', '1', '628293.0000', '17137.0000', '3692.0000'
'ID_58', '1', '167430.0000', '114632.0000', '39218.0000'
'ID_59', '1', '405839.0000', '49707.0000', '29206.0000'
'ID_1', '1', '175823.0000', '79321.0000', '27928.0000'
'ID_62', '1', '92593.0000', '45950.0000', '3595.0000'
'ID_63', '1', '613275.0000', '52404.0000', '20911.0000'
'ID_11', '1', '1042451.0000', '97529.0000', '17296.0000'
'ID_7', '1', '704797.0000', '94395.0000', '17521.0000'
'ID_70', '1', '577695.0000', '74451.0000', '38.0000'
'ID_79', '1', '447342.0000', '61907.0000', '507.0000'
'ID_13', '1', '261203.0000', '36348.0000', '11893.0000'
'ID_15', '1', '526020.0000', '91332.0000', '24710.0000'
'ID_88', '1', '240551.0000', '84461.0000', '25559.0000'
'ID_89', '1', '1065266.0000', '69038.0000', '47812.0000'
'ID_96', '1', '1978192.0000', '54438.0000', '1426.0000'


comment:
> 3월에 A브랜드를 처음 구매한 ID는 33개이다.
> 나머지 67개의 ID는 1월 또는 2월에 A브랜드를 구매했거나 , 3월을 기준으로 아직 A브랜드를 구매하지 않은 ID이다.
> A브랜드를 구매함과 동시에 다른 브랜드도 구매한 ID는 5개이다.
